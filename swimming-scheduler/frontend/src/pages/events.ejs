<% 
    const body = `
    <div class="row mb-4">
        <div class="col-md-6">
            <h2>
                <i class="fas fa-calendar me-2"></i>Swimming Events
            </h2>
        </div>
        <div class="col-md-6 text-md-end">
            <a href="/create-event" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Create New Event
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-filter me-2"></i>Filter Events
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="userFilter" class="form-label">Select User:</label>
                        <select class="form-control" id="userFilter">
                            <option value="">All Users</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="statusFilter" class="form-label">Status:</label>
                        <select class="form-control" id="statusFilter">
                            <option value="">All Statuses</option>
                            <option value="planning">Planning</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <button class="btn btn-outline-primary w-100" onclick="applyFilters()">
                        <i class="fas fa-search me-2"></i>Apply Filters
                    </button>
                </div>
            </div>
        </div>
        <div class="col-lg-9">
            <div id="eventsList">
                <!-- Events will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let allEvents = [];
        let users = [];
        let currentUserId = null;

        document.addEventListener('DOMContentLoaded', async function() {
            await loadUsers();
            await loadEvents();
        });

        async function loadUsers() {
            try {
                const response = await axios.get(window.API_URL + '/users');
                if (response.data.success) {
                    users = response.data.data;
                    populateUserFilter();
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function populateUserFilter() {
            const userFilter = document.getElementById('userFilter');
            userFilter.innerHTML = '<option value="">All Users</option>';
            
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                userFilter.appendChild(option);
            });
        }

        async function loadEvents() {
            // Since we don't have a specific endpoint for all events, 
            // we'll show a placeholder and instructions
            displayEventsPlaceholder();
        }

        function displayEventsPlaceholder() {
            const eventsListHtml = \`
                <div class="alert alert-info">
                    <h5 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>Events Dashboard
                    </h5>
                    <p>This page will show all swimming events. To get started:</p>
                    <ol>
                        <li>First, <a href="/users" class="alert-link">add some users</a> to your system</li>
                        <li>Then <a href="/create-event" class="alert-link">create your first event</a></li>
                        <li>Invite friends to set their availability</li>
                        <li>View the availability report to find the best time for everyone</li>
                    </ol>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-users fa-3x text-primary mb-3"></i>
                                <h5 class="card-title">Manage Users</h5>
                                <p class="card-text">Add and manage friends who will participate in swimming events.</p>
                                <a href="/users" class="btn btn-primary">
                                    <i class="fas fa-users me-2"></i>Go to Users
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-plus fa-3x text-success mb-3"></i>
                                <h5 class="card-title">Create Event</h5>
                                <p class="card-text">Start planning a new swimming event with multiple date options.</p>
                                <a href="/create-event" class="btn btn-success">
                                    <i class="fas fa-plus me-2"></i>Create Event
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-5">
                    <h4>How It Works</h4>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <div class="rounded-circle bg-primary text-white d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                                        <h3 class="mb-0">1</h3>
                                    </div>
                                    <h6 class="card-title">Create Event</h6>
                                    <p class="card-text">Set up a swimming event with multiple proposed dates and times. Invite your friends to participate.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <div class="rounded-circle bg-success text-white d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                                        <h3 class="mb-0">2</h3>
                                    </div>
                                    <h6 class="card-title">Set Availability</h6>
                                    <p class="card-text">Each participant marks their availability for the proposed dates. Everyone can see the real-time updates.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <div class="rounded-circle bg-info text-white d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                                        <h3 class="mb-0">3</h3>
                                    </div>
                                    <h6 class="card-title">Find Best Time</h6>
                                    <p class="card-text">View the availability report to see which dates work best for the most people and confirm your event.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            \`;

            document.getElementById('eventsList').innerHTML = eventsListHtml;
        }

        function applyFilters() {
            // Placeholder for filtering functionality
            showAlert('Filtering functionality will be available once events are created.', 'info');
        }
    </script>
    `;
%>

<%- include('../components/layout', { title, apiUrl, body }) %>